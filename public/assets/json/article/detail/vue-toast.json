{
  "title": "Vue插件：封装独立的通用组件 可复用的单文件式全局Toast弹窗",
  "desc": "最近突然很想简化一些自己写的，项目常用的调用小功能，比如一些弹窗等等，之前都是H/J/C分离，每次复用都要分别写到对应的文件里，略显麻烦。最近看了Vue官网有关于插件打包的说明，尝试了一下还可以，目前成功打包了一个Toast组件。以后每次项目要用到Toast弹窗，只需要引入一个 showToast.vue 即可直接生效调用，而不必在多个文件里维护自己的那部分代码。",
  "keywords": "vue,toast,vue弹窗,vue toast,vue插件",
  "date": "2018-10-11 08:09:00",
  "cover": "http://cdn.chengpeiquan.com/img/2018/10/1-9.jpg?x-oss-process=image/interlace,1",
  "categories": [
    "tech"
  ],
  "repo": "https://github.com/chengpeiquan/vue-toast",
  "id": "vue-toast",
  "type": "article",
  "author": {
    "name": "chengpeiquan",
    "email": "chengpeiquan@chengpeiquan.com",
    "link": "https://chengpeiquan.com"
  },
  "shortDate": "2018-10-11",
  "content": "<p>[[toc]]</p>\n<p>最近突然很想简化一些自己写的，项目常用的调用小功能，比如一些弹窗等等，之前都是 Html/JavaScript/Css 分离，每次复用都要分别写到对应的文件里，略显麻烦。</p>\n<p>最近看了 Vue 官网有关于插件打包的说明，尝试了一下还可以，目前成功打包了一个 Toast 组件。以后每次项目要用到 Toast 弹窗，只需要引入一个 showToast.vue 即可直接生效调用，而不必在多个文件里维护自己的那部分代码。</p>\n<h2>功能说明</h2>\n<p>1、支持自定义弹窗文案，并自动计算弹窗的高度调整在屏幕的位置，以一直保持居中</p>\n<p>2、支持自定义弹窗显示时长（默认 2 秒，单位毫秒）</p>\n<p>3、支持回调函数，callback 将在设定的时间结束后才执行</p>\n<h2>使用方式</h2>\n<p>1、将 showToast.vue 文件放置于项目的模板文件夹（个人习惯为 src/components）</p>\n<p>2、打开 App.vue，引入 vue 和 showToast 组件，并 use 该组件（其实是 use 组件里的方法，只不过打包为一个文件了）。</p>\n<p>template 部分（举例，主要就是 showToast 那里）：</p>\n<pre><code class=\"language-js\">&lt;template&gt;\n  &lt;div id=&quot;app&quot;&gt;\n    &lt;router-view&gt;&lt;/router-view&gt;\n    &lt;ShowToast&gt;&lt;/ShowToast&gt;\n  &lt;/div&gt;\n&lt;/template&gt;\n</code></pre>\n<p>script 部分：</p>\n<pre><code class=\"language-js\">//引入Vue\nimport Vue from 'vue'\n\n//引入组件，@cp是我自定义的路径别名，相当于@/components/\nimport ShowToast from '@cp/showToast.vue'\n\n//注册使用方法\nVue.use(ShowToast)\n\n//添加模板\nexport default {\n  name: 'App',\n  components: { ShowToast },\n}\n</code></pre>\n<p>3、之后在 App.vue 或者任意子组件里，就可以直接通过 this.$showToast(文案, 显示时间, 回调函数) 去唤起 Toast 弹窗了。</p>\n<pre><code class=\"language-js\">//默认2秒的弹窗\nthis.$showToast('默认2秒的弹窗')\n\n//持续显示10秒的弹窗\nthis.$showToast('持续显示10秒', 10000)\n\n//执行回调函数\nthis.$showToast('发布成功，即将进入首页…', 2000, () =&gt; {\n  this.$router.push({\n    name: 'home',\n  })\n})\n</code></pre>\n<h2>效果预览</h2>\n<p><img src=\"http://cdn.chengpeiquan.com/img/2021/02/20210217012731.jpg?x-oss-process=image/interlace,1/resize,w_750\" alt=\"\"></p>\n<h2>组件源码</h2>\n<p>我使用的是 stylus，样式在这里就随便写一下，请根据实际项目需要做调整和本地备份。</p>\n<pre><code class=\"language-html\">&lt;template&gt;\n  &lt;div class=&quot;common-toast&quot;&gt;\n    &lt;div class=&quot;content&quot;&gt;\n      &lt;p&gt;\n        &lt;span&gt;&lt;/span&gt;\n      &lt;/p&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n&lt;/template&gt;\n\n&lt;script&gt;\n  const showToast = {\n    install(Vue, options) {\n      Vue.prototype.$showToast = function (text, duration = 2000, callback) {\n        document.querySelector('.common-toast').style.display = 'block'\n        const newToast = document.querySelector('.common-toast .content')\n        newToast.querySelector('span').innerText = text\n        setTimeout((w, h) =&gt; {\n          w = newToast.offsetWidth\n          h = newToast.offsetHeight\n          newToast.style.marginTop = '-' + h / 2 + 'px'\n          newToast.style.marginLeft = '-' + w / 2 + 'px'\n        }, 10)\n        setTimeout(() =&gt; {\n          document.querySelector('.common-toast').style.display = 'none'\n          if (typeof callback === 'function') {\n            callback()\n          }\n        }, duration)\n      }\n    },\n  }\n  export default showToast\n&lt;/script&gt;\n\n&lt;style lang=&quot;stylus&quot; scoped&gt;\n  .common-toast\n  \tdisplay none\n  \tposition fixed\n  \ttop 0\n  \tleft 0\n  \twidth 100%\n  \theight 100%\n  \tbackground-color rgba(0,0,0,0.6)\n  \tz-index 999998\n  \t.content\n  \t\tposition absolute\n  \t\ttop 50%\n  \t\tleft 50%\n  \t\tmargin-top -1rem\n  \t\tmargin-left -3rem\n  \t\tbackground-color rgba(0,0,0,0.4)\n  \t\tbox-shadow 0 0 10px rgba(0,0,0,0.2)\n  \t\tcolor #fff\n  \t\ttext-align center\n  \t\tborder-radius 6px\n  \t\tz-index 999999\n  \t\tp\n  \t\t\tdisplay table-cell\n  \t\t\tvertical-align middle\n  \t\t\twidth 6rem\n  \t\t\theight 2rem\n  \t\t\tbox-sizing border-box\n  \t\t\tpadding 0.2rem\n  \t\t\toverflow hidden\n  \t\tspan\n  \t\t\tfont-size 0.3865rem\n  \t\t\tvertical-align middle\n  \t\t\tcolor #fff\n&lt;/style&gt;\n</code></pre>\n<p>保存为 showToast.vue 文件到项目模板文件夹下即可，以后如果要引用，就直接引入该文件就 ok。</p>\n<p>最后附上项目的 github 地址</p>\n<blockquote>\n<p><a href=\"https://github.com/chengpeiquan/vue-toast\">https://github.com/chengpeiquan/vue-toast</a></p>\n</blockquote>\n"
}