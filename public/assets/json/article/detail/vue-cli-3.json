{
  "title": "Vue-CLI脚手架3.0升级小结（含Win版Node升级与PowerShell踩坑记录）",
  "desc": "Vue脚手架3.0出来也蛮久了，秉着前人先踩坑的习惯，最近才开始升级。整个过程还是蛮顺利的，不过也有一些小小的问题，简单记录起来。",
  "keywords": "vue cli 3.0 升级,vue cli 升级报错",
  "date": "2018-11-22 03:50:00",
  "cover": "http://cdn.chengpeiquan.com/img/2018/11/1-2.jpg?x-oss-process=image/interlace,1",
  "categories": [
    "tech"
  ],
  "id": "vue-cli-3",
  "type": "article",
  "author": {
    "name": "chengpeiquan",
    "email": "chengpeiquan@chengpeiquan.com",
    "link": "https://chengpeiquan.com"
  },
  "shortDate": "2018-11-22",
  "content": "<p>[[toc]]</p>\n<p>Vue 脚手架 3.0 出来也蛮久了，秉着前人先踩坑的习惯，最近才开始升级。整个过程还是蛮顺利的，不过也有一些小小的问题，简单记录起来。</p>\n<p>系统版本：Windows 7 64 位（公司限制无法使用管理员权限）</p>\n<p>命令程序：PowerShell（公司限制无法使用 CMD）</p>\n<blockquote>\n<p>官方文档 <a href=\"https://cli.vuejs.org/zh/guide/\">https://cli.vuejs.org/zh/guide/</a></p>\n</blockquote>\n<h2>关于 Node.js 版本升级</h2>\n<p>Vue-cli 3.0 需要 8.9 或者更高的 node，官方推荐 8.11+，我 check 了一下本机的 node 版本，有点老，才 7.0，于是需要先解决版本升级的问题。</p>\n<p>先从官网下载 node 安装包，由于公司是 Windows 的机器，而且不开放管理员权限，无法直接通过 msi 文件安装，于是选择了下载 zip 免安装包，下载后直接解压，覆盖原来的 node 目录的文件即可升级。</p>\n<p>然而一开始选择的最新版 node 目前使用有问题，安装 npm 包的时候一直报错 asyncWrite is not a function，半天定位不到原因，后来在 stackoverflow 上看到这个问题，通过降级到 8.11.2 来解决（所以最新版还是不知道什么原因和怎么解决 emmm）。</p>\n<blockquote>\n<p><a href=\"https://stackoverflow.com/questions/50597159/npm-err-asyncwrite-is-not-a-function\">https://stackoverflow.com/questions/50597159/npm-err-asyncwrite-is-not-a-function</a></p>\n</blockquote>\n<p><img src=\"http://cdn.chengpeiquan.com/img/2018/11/1.jpg?x-oss-process=image/interlace,1/resize,w_750\" alt=\"\"></p>\n<p>附上 Node 的相关下载地址。</p>\n<blockquote>\n<p>官网下载 <a href=\"https://nodejs.org/zh-cn/download/\">https://nodejs.org/zh-cn/download/</a><br>历史版本 <a href=\"https://nodejs.org/zh-cn/download/releases/\">https://nodejs.org/zh-cn/download/releases/</a><br>我选的版本 <a href=\"https://nodejs.org/download/release/v8.11.2/node-v8.11.2-win-x64.zip\">https://nodejs.org/download/release/v8.11.2/node-v8.11.2-win-x64.zip</a></p>\n</blockquote>\n<h2>关于 Node 的环境变量</h2>\n<p>直接通过安装包安装的 node 现在都不需要配置这个了，会自动设置好，但如果跟我一样，没有管理员权限，通过 zip 解压的话，第一次使用 node 需要关联上这个 path。</p>\n<p>方法也比较简单，就直接截图示范了，path 的内容就是你的 node 的路径。</p>\n<p><img src=\"http://cdn.chengpeiquan.com/img/2018/11/2.jpg?x-oss-process=image/interlace,1/resize,w_750\" alt=\"\"></p>\n<h2>安装 Vue-CLI 3.0</h2>\n<p>本来以为要踩坑也得等到使用的时候才会踩，安装怎么说也得很顺利吧，然而现实就是比较残酷，安装的时候就踩了个大坑。</p>\n<p>根据官方文档说明，卸载了旧版脚手架之后，使用 <code>npm install -g @vue/cli</code> 就可以直接安装，但是频繁报错，说存在无法识别的标记，如下图：</p>\n<p><img src=\"http://cdn.chengpeiquan.com/img/2018/11/3.jpg?x-oss-process=image/interlace,1/resize,w_750\" alt=\"\"></p>\n<p>并且这个问题，百度和谷歌都找不到原因，根本没有人提问，我能怎么办，我很绝望啊！</p>\n<p>幸亏天无绝人之路，有位同事对 PowerShell 比较熟，一眼就帮我看出问题所在，是@引起的，在 CMD 是可以直接这么安装，但是在 PS，@是个特殊字符，需要进行转义，需要在@前面加上`，再次尝试 ，转义后立即可以安装了，感动到哭。</p>\n<p><img src=\"http://cdn.chengpeiquan.com/img/2018/11/4.jpg?x-oss-process=image/interlace,1/resize,w_750\" alt=\"\"></p>\n<h2>修改 Vue 项目配置</h2>\n<p>3.0 的目录结构比 2.0 精简了好多，具体的这里不细说了，官方文档也说的很清晰，这里附上我在用的 vue.config.js 文件给大家参考。</p>\n<p>配置文档说明 <a href=\"https://cli.vuejs.org/zh/config/\">https://cli.vuejs.org/zh/config/</a></p>\n<pre><code class=\"language-javascript\">const path = require('path')\nfunction resolve(dir) {\n  return path.join(__dirname, dir)\n}\n\nmodule.exports = {\n  publicPath: './',\n  assetsDir: 'static',\n  productionSourceMap: false,\n  lintOnSave: false,\n  chainWebpack: (config) =&gt; {\n    config.resolve.alias\n      .set('@', resolve('src'))\n      .set('@img', resolve('src/assets/img'))\n      .set('@styl', resolve('src/assets/styl'))\n      .set('@js', resolve('src/assets/js'))\n      .set('@cp', resolve('src/components'))\n      .end()\n    config.module\n      .rule('images')\n      .test(/\\.(png|jpe?g|gif|webp|svg)(\\?.*)?$/)\n      .use('url-loader')\n      .loader('url-loader')\n      .options({\n        limit: 10000,\n        fallback: {\n          loader: 'file-loader',\n          options: {\n            name: 'static/img/[name].[hash:8].[ext]',\n          },\n        },\n      })\n      .end()\n  },\n}\n</code></pre>\n"
}